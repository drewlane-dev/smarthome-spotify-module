<div class="spotify-container">
  <div class="spotify-header">
    <span class="material-icons spotify-icon">music_note</span>
    <h2>{{ moduleDefinition?.displayName || 'Spotify Connect' }}</h2>
  </div>

  <div class="spotify-content">
    @if (loading && !moduleStatus) {
      <div class="loading-state">
        <span class="material-icons spinning">sync</span>
        <p>Loading...</p>
      </div>
    } @else if (moduleStatus?.serviceDeployed) {
      <div class="status-section">
        <div class="status-item">
          <span class="status-label">Status:</span>
          <span class="status-value" [class.running]="moduleStatus?.serviceRunning">
            {{ moduleStatus?.serviceRunning ? 'Running' : 'Stopped' }}
          </span>
        </div>
        @if (moduleStatus?.podStatus) {
          <div class="status-item">
            <span class="status-label">Pod:</span>
            <span class="status-value">{{ moduleStatus?.podStatus }}</span>
          </div>
        }
        @for (field of moduleDefinition?.fields; track field.name) {
          @if (moduleStatus?.fieldValues?.[field.name]) {
            <div class="status-item">
              <span class="status-label">{{ field.label }}:</span>
              <span class="status-value">{{ moduleStatus?.fieldValues?.[field.name] }}</span>
            </div>
          }
        }
      </div>

      @if (error) {
        <div class="error-message">
          <span class="material-icons">error</span>
          {{ error }}
        </div>
      }

      <button class="action-btn danger" (click)="remove()" [disabled]="loading">
        @if (loading) {
          <span class="material-icons spinning">sync</span>
        } @else {
          <span class="material-icons">delete</span>
        }
        Remove
      </button>
    } @else {
      @if (moduleDefinition?.description) {
        <p class="description">{{ moduleDefinition?.description }}</p>
      }

      @for (field of moduleDefinition?.fields; track field.name) {
        <div class="form-group">
          <label [for]="field.name">{{ field.label }}</label>
          @if (field.type === 'select' && field.options) {
            <select
              [id]="field.name"
              [(ngModel)]="fieldValues[field.name]"
            >
              @for (option of field.options; track option) {
                <option [value]="option">{{ option }}</option>
              }
            </select>
          } @else {
            <input
              [type]="field.type"
              [id]="field.name"
              [(ngModel)]="fieldValues[field.name]"
              [placeholder]="field.defaultValue || ''"
            />
          }
          @if (field.description) {
            <span class="field-hint">{{ field.description }}</span>
          }
        </div>
      }

      @if (error) {
        <div class="error-message">
          <span class="material-icons">error</span>
          {{ error }}
        </div>
      }

      <button class="action-btn primary" (click)="deploy()" [disabled]="loading">
        @if (loading) {
          <span class="material-icons spinning">sync</span>
        } @else {
          <span class="material-icons">check</span>
        }
        Enable {{ moduleDefinition?.displayName || 'Module' }}
      </button>
    }
  </div>
</div>
